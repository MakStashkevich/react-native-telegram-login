# React Native Telegram Login

### –≠–¢–û –≠–ö–°–ü–ï–†–ò–ú–ï–ù–¢–ê–õ–¨–ù–´–ô –ü–†–û–ï–ö–¢, –ö–û–¢–û–†–´–ô –ù–ï –°–†–ê–ë–û–¢–ê–õ! üò≠

<p align="center">
  <img src="readme-assets/screenshot.jpg" alt="–°–∫—Ä–∏–Ω—à–æ—Ç —Ä–∞–±–æ—Ç—ã React Native Telegram –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏" width="400"/>
</p>

## –ö–∞–∫ —è –¥–µ–ª–∞–ª –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram –∏ –ø–æ—á–µ–º—É –æ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç..

–ù–∞ –æ–¥–Ω–æ–º –∏–∑ –ø—Ä–æ–µ–∫—Ç–æ–≤ —è –¥–µ–ª–∞—é React Native –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è Android –∏ IOS.

–ó–∞–∫–∞–∑—á–∏–∫ –∑–∞—Ö–æ—Ç–µ–ª —Å–¥–µ–ª–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤ –æ–¥–∏–Ω –∫–ª–∏–∫ —á–µ—Ä–µ–∑ Telegram.

Telegram –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OAuth, —É –Ω–µ–≥–æ –Ω–µ—Ç API –∏ –≥–æ—Ç–æ–≤–æ–≥–æ SDK.

–í –Ω–∞—à–µ–º —Ä–∞—Å–ø–æ—Ä—è–∂–µ–Ω–∏–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–∂–µ—Ç. –ï–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –∑–¥–µ—Å—å:

https://core.telegram.org/widgets/login

–ù–µ–¥–æ–ª–≥–æ –¥—É–º–∞—è —è —Ä–µ—à–∏–ª —Å–¥–µ–ª–∞—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–∂–µ—Ç–∞ –Ω–∞—Ç–∏–≤–Ω–æ —á–µ—Ä–µ–∑ WebView Android.

–≠—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–Ω–µ —Å–ø–æ—Å–æ–± –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.

–í–æ—Ç —á—Ç–æ —è —Å–¥–µ–ª–∞–ª:

1. –°–æ–∑–¥–∞–ª –±–æ—Ç–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather) –∫–æ–º–∞–Ω–¥–æ–π /newbot
2. –£—Å—Ç–∞–Ω–æ–≤–∏–ª –±–æ—Ç—É –¥–æ–º–µ–Ω —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥–æ–π /setdomain

–î–ª—è —Ç–µ—Å—Ç–æ–≤ —è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª –¥–æ–º–µ–Ω —Å–∞–º–æ–≥–æ —Ç–µ–ª–µ–≥—Ä–∞–º https://telegram.org

–≠—Ç–æ—Ç –¥–æ–º–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞, –≤–º–µ—Å—Ç–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –≤–∞—à–µ–≥–æ –±–æ—Ç–∞.

–¢–∞–∫–∂–µ, —ç—Ç–æ—Ç –¥–æ–º–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —É–∫–∞–∑–∞–Ω–Ω–æ–º—É CGI –ø–∞—Ä–∞–º–µ—Ç—Ä—É origin –≤ —Å—Å—ã–ª–∫–µ.

3. –°–æ–∑–¥–∞–ª –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ WebView –Ω–∞ Java –∏—Å–ø–æ–ª—å–∑—É—è [–º–æ—Å—Ç React Native](https://www.geeksforgeeks.org/what-is-a-bridge-in-react-native/)

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ WebView –º–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–¥–µ—Å—å: [–∫–ª–∏–∫](https://github.com/MakStashkevich/react-native-telegram-login/blob/main/android/src/main/java/com/makstashkevich/telegramlogin/internal/WebViewLoginActivity.java#L270)

```java
private class WebViewClient extends android.webkit.WebViewClient {
    // ...
}
```

**4. –ò –≤–æ—Ç —Ç—É—Ç —è —É–∑–Ω–∞—é —á—Ç–æ‚Ä¶ –ö–£–ö–ò –ù–ï –†–ê–ë–û–¢–ê–Æ–¢!**

–£ WebView —Å—Ç—Ä–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç—ã Cookie, –∫–∞–∫ –±—ã —è –Ω–µ –ø—ã—Ç–∞–ª—Å—è –∏—Ö –≤–∫–ª—é—á–∏—Ç—å –Ω–∞—Ç–∏–≤–Ω–æ ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ –¥–∞–≤–∞–ª–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

–î–µ–ª–æ –≤ —Ç–æ–º, —á—Ç–æ Telegram –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –ª—é–±—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ Cookie: `stel_ln`

–ï—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Response Header Set-Cookie —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∫–ª—é—á–æ–º.

–ù–æ –º—ã –Ω–µ –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å Response –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ WebView.

5. –í –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –ª—é–¥–∏ –ø–∏—à—É—Ç ‚Äú–Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `shouldInterceptRequest()` –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤‚Äù

–•–æ—Ä–æ—à–æ, —è —Å–¥–µ–ª–∞–ª –∫–∞–∫ –æ–Ω–∏ —Å–∫–∞–∑–∞–ª–∏.

```java
@SuppressLint("NewApi")
@Override
public WebResourceResponse shouldInterceptRequest(WebView view, WebResourceRequest request) {
  if (request != null && request.getUrl() != null && request.getUrl().toString().contains("telegram.org")) {
    String scheme = request.getUrl().getScheme().trim();
    if (scheme.equalsIgnoreCase("http") || scheme.equalsIgnoreCase("https")) {
      // –ó–¥–µ—Å—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤
      return executeRequest(request);
    }
  }
  return super.shouldInterceptRequest(view, request);
}
```

–í –º–æ–º–µ–Ω—Ç –∫–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–ª—Å—è –∑–∞–ø—Ä–æ—Å ‚Äî —è –µ–≥–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é –∏ –∏–º–∏—Ç–∏—Ä—É—é –∑–∞–ø—Ä–æ—Å –ø–æ–≤—Ç–æ—Ä–Ω–æ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –º–Ω–µ ‚ÄúSet-Cookie‚Äù.

```java
OkHttpClient okHttpClient = new OkHttpClient();
final Call call = okHttpClient.newCall(new Request.Builder()
  .url(request.getUrl().toString())
  .method(request.getMethod(), request.getMethod().equalsIgnoreCase("POST") ? RequestBody.create(null, new byte[0]) : null)
  .headers(Headers.of(request.getRequestHeaders()))
  .build()
);
try {
  final Response response = call.execute();
  // ...
}
```

–≠—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å..

–ò –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ —ç—Ç–æ –¥–∞—Å—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç..

–ù–æ‚Ä¶

6. –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–ª—é—á–∏ `stel_ln`, `stel_ssid` –∏ –¥—Ä—É–≥–∏–µ **_–ø–µ—Ä–µ–ø—É—Ç—ã–≤–∞–ª–∏—Å—å_** —Å —Ç–µ–º–∏, —á—Ç–æ —è –ø–æ–ª—É—á–∞–ª –∏–º–∏—Ç–∏—Ä—É—è –∑–∞–ø—Ä–æ—Å.

Telegram —Å—á–∏—Ç–∞–ª –µ–≥–æ —É–∂–µ –Ω–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–ª –æ—à–∏–±–∫—É `‚ÄúSession expired‚Äù`.

![Telegram OAuth response session expired](./readme-assets/session_expired.jpg)

–ß—Ç–æ –∂–µ —Å —ç—Ç–∏–º –¥–µ–ª–∞—Ç—å?

**7. –ü–æ—Å–ª–µ–¥–Ω—è—è –Ω–∞–¥–µ–∂–¥–∞ ‚Äî –¥–µ–ª–∞–µ–º –≤–µ–ª–æ—Å–∏–ø–µ–¥.**

![evaluate javascript from Android Java](./readme-assets/run_js.jpg)

–ë—ã–ª–æ —Ä–µ—à–µ–Ω–æ –≤–Ω–µ–¥—Ä—è—Ç—å javascript –∫–æ–¥ –≤ –∑–∞–≥—Ä—É–∂–∞–µ–º—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É WebView –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å `XMLHttpRequest.prototype.open`

–ß—Ç–æ–±—ã –ø–æ—Ç–æ–º –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏ –µ–≥–æ –æ—Ç–≤–µ—Ç.

–°–¥–µ–ª–∞—Ç—å —ç—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é:

```java
String js = "(function() { console.log('This message send from Java!!!'); return 'Hello!' })();";
webView.evaluateJavascript(js, new ValueCallback<String>() {
  @TargetApi(Build.VERSION_CODES.HONEYCOMB)
  @Override
  public void onReceiveValue(String s) {
    // –ü–æ–∫–∞–∂–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ–≥–æ javascript
    // "Hello!"
    Log.d("TAG", s);
  }
});
```

–ö–∞–∫ –æ–∫–∞–∑–∞–ª–æ—Å—å, –¥–∞–ª–µ–∫–æ –Ω–∞ —Ç–∞–∫–æ–º –≤–µ–ª–æ—Å–∏–ø–µ–¥–µ –Ω–µ —É–µ–¥–µ—à—å.

–ú–µ–Ω—è –≤—Å—Ç—Ä–µ—Ç–∏–ª–∞ –Ω–∞ –ø—É—Ç–∏..

8. –û—à–∏–±–∫–∞: `Refused to get unsafe header "Set-Cookie"`

![Refused to get unsafe header "Set-Cookie"](./readme-assets/unsafe_header.jpg)

–ö–∞–∫ –æ–∫–∞–∑–∞–ª–æ—Å—å –Ω–µ–ª—å–∑—è —á–∏—Ç–∞—Ç—å –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–π –∏–ª–∏ –∫–∞–∫ —Å–∫–∞–∑–∞–Ω–æ –≤—ã—à–µ, ‚Äú–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫‚Äù —Å –Ω–∞—à–∏–º–∏ –ª—é–±–∏–º—ã–º–∏ Cookies.

–ö–∞–∫–∏–µ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ –Ω–µ –¥–µ–ª–∞–π ‚Äî –±—Ä–∞—É–∑–µ—Ä –Ω–µ –¥–∞—Å—Ç –∏—Ö —Å—á–∏—Ç–∞—Ç—å.

–Ø –ø—Ä–æ–≤–µ—Ä–∏–ª.

---

–¢—ã –º–æ–∂–µ—à—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–π –ø—Ä–æ–µ–∫—Ç, –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç.

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ React Native:

```typescript jsx
import React from 'react';
import {View, Button} from 'react-native';
import {getTelegramUserInfo} from 'react-native-telegram-login';

export const TelegramLoginButton = () => {
  async function onTelegramLogin() {
    // –î–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è WebView —á–µ—Ä–µ–∑ OAuth Telegram
    await telegramLogin();
    // –ò–ª–∏.. –æ—Ç–∫—Ä—ã—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const userInfo = await getTelegramUserInfo();
    console.log({userInfo});
  }

  return (
    <View style={{margin: 10}}>
      <Button color="blue" title="Telegram Login" onPress={onTelegramLogin}/>
    </View>
  );
};
````
